import{d as e,g as t,h as a,n,F as i,k as s,t as r,z as l,r as o,c as d,x as c,o as u,P as m,e as p}from"./vendor-vue.CBtg5bt5.js";import{b as y}from"./index.D8gGT4XT.js";import"./auto.DSFENr0L.js";import{_ as g}from"./_plugin-vue_export-helper.BCo6x5W8.js";import{C as h}from"./vendor-chart.DPoKKmb6.js";function v(){const{toast:e}=y(),t=[{id:"elektrik_tasarim",name:"Elektrik Tasarım",capacity:160},{id:"mekanik_tasarim",name:"Mekanik Tasarım",capacity:120},{id:"satin_alma",name:"Satın Alma",capacity:80},{id:"mekanik_uretim",name:"Mekanik Üretim",capacity:200},{id:"ic_montaj",name:"İç Montaj",capacity:240},{id:"kablaj",name:"Kablaj",capacity:320},{id:"genel_montaj",name:"Genel Montaj",capacity:280},{id:"test",name:"Test",capacity:160}],a=[{id:"SPR-2025-001",orderId:"SPR-2025-001",customerName:"İBB Elektrik",cellType:"RM 36 CB",quantity:2,status:"production",priority:"high"},{id:"SPR-2025-002",orderId:"SPR-2025-002",customerName:"Antalya Belediyesi",cellType:"RM 36 LB",quantity:5,status:"production",priority:"medium"},{id:"SPR-2025-003",orderId:"SPR-2025-003",customerName:"TEDAŞ Ankara",cellType:"RM 36 FL",quantity:3,status:"pending",priority:"medium"},{id:"SPR-2025-004",orderId:"SPR-2025-004",customerName:"Bursa Enerji",cellType:"RM 36 MB",quantity:1,status:"production",priority:"high"},{id:"SPR-2025-005",orderId:"SPR-2025-005",customerName:"İzmir Elektrik",cellType:"RM 36 CB",quantity:4,status:"approved",priority:"low"}],n=e=>{let t=0;const a=e.quantity||1;switch((e.cellType||"unknown").toLowerCase()){case"rm 36 cb":t=10;break;case"rm 36 lb":t=12;break;case"rm 36 fl":t=15;break;case"rm 36 mb":t=18;break;default:t=8}return t*=a,Math.max(1,t)},i=async e=>{var t,a;let i=[],s=new Date;s.setHours(8,0,0,0);for(const r of e){const e=60*n(r)*60*1e3;let l=new Date(s),o=new Date(s.getTime()+e);6===o.getDay()?(o.setDate(o.getDate()+2),o.setHours(8,0,0,0)):0===o.getDay()&&(o.setDate(o.getDate()+1),o.setHours(8,0,0,0));const d=(null==(t=r.cellType)?void 0:t.includes("CB"))?"elektrik_tasarim":(null==(a=r.cellType)?void 0:a.includes("LB"))?"mekanik_tasarim":"genel_montaj";i.push({id:`task-${r.orderId||r.id}`,orderId:r.orderId||r.id,taskName:`Sipariş: ${r.orderId||r.id} (${r.cellType||"N/A"})`,start:l,end:o,resourceId:d}),s=new Date(o)}return i},s=e=>{const a={};t.forEach((e=>a[e.id]=0));const n=new Date,i=new Date(n.getTime()+6048e5);return e.forEach((e=>{if(e.start<i&&e.end>n){const t=e.resourceId||"genel_montaj",n=(e.end-e.start)/36e5;void 0!==a[t]?a[t]+=n:a.genel_montaj+=n}})),a},r=e=>e.map((e=>({orderId:e.orderId,estimatedDeliveryDate:e.end})));return{getPlanningData:async()=>{try{await new Promise((e=>setTimeout(e,1e3)));const e=[...a],n=await i(e),l=s(n),o=r(n);return{orders:e,productionUnits:t,schedule:n,capacityLoad:l,deliveryEstimates:o}}catch(e){throw new Error("Planlama verileri yüklenemedi: "+(e.message||"Bilinmeyen hata"))}},estimateProductionTime:n,updatePlanningParameters:async t=>{try{return await new Promise((e=>setTimeout(e,800))),e.success("Planlama parametreleri güncellendi"),{success:!0,message:"Parametreler güncellendi"}}catch(a){throw e.error("Parametreler güncellenemedi"),new Error("Parametreler güncellenemedi: "+(a.message||"Bilinmeyen hata"))}}}}const b=e("planning",{state:()=>({orders:[],productionUnits:[],schedule:[],capacityLoad:{},deliveryEstimates:[],isLoading:!1,error:null}),getters:{highPriorityOrders:e=>e.orders.filter((e=>"high"===e.priority)),sortedDeliveries:e=>[...e.deliveryEstimates].sort(((e,t)=>new Date(e.estimatedDeliveryDate)-new Date(t.estimatedDeliveryDate))),highestLoadedUnit:e=>e.productionUnits.length&&0!==Object.keys(e.capacityLoad).length?e.productionUnits.map((t=>({...t,load:e.capacityLoad[t.id]||0,percentage:(e.capacityLoad[t.id]||0)/t.capacity*100}))).sort(((e,t)=>t.percentage-e.percentage))[0]:null,capacityPercentages:e=>{const t={};return e.productionUnits.forEach((a=>{const n=e.capacityLoad[a.id]||0;t[a.id]=Math.min(100,n/a.capacity*100)})),t}},actions:{async fetchPlanningData(){const e=v();this.isLoading=!0,this.error=null;try{const t=await e.getPlanningData();return this.orders=t.orders,this.productionUnits=t.productionUnits,this.schedule=t.schedule,this.capacityLoad=t.capacityLoad,this.deliveryEstimates=t.deliveryEstimates,t}catch(t){throw this.error=t.message||"Planlama verileri yüklenemedi",t}finally{this.isLoading=!1}},async updateParameters(e){const t=v();try{const a=await t.updatePlanningParameters(e);return a.success&&await this.fetchPlanningData(),a}catch(a){throw this.error=a.message||"Parametreler güncellenemedi",a}}}}),k={class:"planning-module"},w={class:"row mb-4"},D={class:"col-12"},f={class:"card"},P={class:"card-body"},T={key:0,class:"text-center py-4"},x={key:1,class:"text-center py-4"},S={key:2,id:"productionCalendar"},C={class:"list-group"},L={class:"row"},j={class:"col-md-6"},R={class:"card"},B={class:"card-header d-flex justify-content-between align-items-center"},E={class:"dropdown"},U={class:"btn btn-sm btn-outline-secondary dropdown-toggle",type:"button",id:"capacityDropdown","data-bs-toggle":"dropdown","aria-expanded":"false"},I={class:"dropdown-menu","aria-labelledby":"capacityDropdown"},_=["onClick"],M={class:"card-body"},A={class:"chart-container",style:{height:"300px",position:"relative"}},N={ref:"capacityChart"},q={class:"col-md-6"},F={class:"card"},G={class:"card-header d-flex justify-content-between align-items-center"},K={class:"dropdown"},$={class:"btn btn-sm btn-outline-secondary dropdown-toggle",type:"button",id:"deliveryDropdown","data-bs-toggle":"dropdown","aria-expanded":"false"},H={class:"dropdown-menu","aria-labelledby":"deliveryDropdown"},O=["onClick"],Y={class:"card-body"},z={class:"chart-container",style:{height:"300px",position:"relative"}},Z={ref:"deliveryChart"};const W=g({name:"Planning",setup(){const e=b(),t=o(null),a=o(null);let n=null,i=null;const s=o(!0),r=o(null),l=o("30d"),p={"7d":"Son 7 Gün","30d":"Son 30 Gün","90d":"Son 90 Gün","1y":"Bu Yıl"},y=d((()=>p[l.value])),g=d((()=>e.productionUnits)),v=d((()=>e.capacityLoad)),k=d((()=>e.schedule)),w=d((()=>e.deliveryEstimates)),D=d((()=>[...k.value].sort(((e,t)=>new Date(e.start)-new Date(t.start))))),f=()=>{t.value&&g.value.length&&m((()=>{const e=t.value.getContext("2d");n&&n.destroy();const a=r.value?[r.value]:g.value,i=a.map((e=>e.name)),s=a.map((e=>{const t=v.value[e.id]||0,a=e.capacity||1;return Math.min(100,t/a*100)})),l=a.map((e=>{const t=(v.value[e.id]||0)/(e.capacity||1);return t>.9?"rgba(255, 99, 132, 0.6)":t>.7?"rgba(255, 206, 86, 0.6)":"rgba(75, 192, 192, 0.6)"})),o=l.map((e=>e.replace("0.6","1")));n=new h(e,{type:"bar",data:{labels:i,datasets:[{label:"Haftalık Kapasite Kullanım Yüzdesi (%)",data:s,backgroundColor:l,borderColor:o,borderWidth:1}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0,max:100,title:{display:!0,text:"Kullanım Oranı (%)"}}},plugins:{tooltip:{callbacks:{label:function(e){const t=e.label,a=g.value.find((e=>e.name===t)),n=v.value[null==a?void 0:a.id]||0;let i=e.dataset.label||"";return i&&(i+=": "),null!==e.parsed.y&&(i+=e.parsed.y.toFixed(1)+"%",a&&(i+=` (${n.toFixed(1)} / ${a.capacity} saat)`)),i}}}}}})}))},P=()=>{a.value&&w.value.length&&m((()=>{const e=a.value.getContext("2d");i&&i.destroy();const t=new Date,n=new Date;switch(l.value){case"7d":n.setDate(t.getDate()-7);break;case"90d":n.setDate(t.getDate()-90);break;case"1y":n.setFullYear(t.getFullYear()-1);break;default:n.setDate(t.getDate()-30)}const s={};w.value.forEach((e=>{const a=new Date(e.estimatedDeliveryDate);if(a>=n&&a<=t){const e=a.toISOString().split("T")[0];s[e]=(s[e]||0)+1}}));const r=[],o=[];let d=new Date(n);for(;d<=t;){const e=d.toISOString().split("T")[0];r.push(e),o.push(s[e]||0),d.setDate(d.getDate()+1)}i=new h(e,{type:"line",data:{labels:r,datasets:[{label:`Günlük Tahmini Teslimat Sayısı (${y.value})`,data:o,borderColor:"rgb(75, 192, 192)",tension:.1,fill:!1}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0,title:{display:!0,text:"Teslimat Sayısı"}},x:{title:{display:!0,text:"Tarih"}}}}})}))};return c(v,f),c(w,P),u((()=>{(async()=>{s.value=!0;try{await e.fetchPlanningData()}catch(t){}finally{s.value=!1}})().then((()=>{f(),P()}))})),{loading:s,productionUnits:g,schedule:k,sortedSchedule:D,selectedUnit:r,selectedPeriod:l,timePeriods:p,timePeriodLabel:y,capacityChart:t,deliveryChart:a,formatDate:e=>new Date(e).toLocaleString("tr-TR"),selectUnit:e=>{r.value=e,f()},selectTimePeriod:e=>{l.value=e,P()}}}},[["render",function(e,o,d,c,u,m){return p(),t("div",k,[a("div",w,[a("div",D,[a("div",f,[o[5]||(o[5]=a("div",{class:"card-header d-flex justify-content-between align-items-center"},[a("h5",{class:"mb-0"},"Üretim Takvimi"),a("div",{class:"btn-group",role:"group"},[a("button",{type:"button",class:"btn btn-sm btn-outline-primary active"},"Günlük"),a("button",{type:"button",class:"btn btn-sm btn-outline-primary"},"Haftalık"),a("button",{type:"button",class:"btn btn-sm btn-outline-primary"},"Aylık")])],-1)),a("div",P,[a("div",{class:n(["calendar-container",{loading:c.loading}])},[c.loading?(p(),t("div",T,o[1]||(o[1]=[a("div",{class:"spinner-border text-primary",role:"status"},[a("span",{class:"visually-hidden"},"Yükleniyor...")],-1),a("p",{class:"mt-2"},"Planlama verileri yükleniyor...",-1)]))):0===c.schedule.length?(p(),t("div",x,o[2]||(o[2]=[a("p",{class:"text-muted"},"Planlanmış üretim bulunmuyor.",-1)]))):(p(),t("div",S,[a("ul",C,[(p(!0),t(i,null,s(c.sortedSchedule,(e=>(p(),t("li",{key:e.id,class:"list-group-item"},[a("strong",null,r(e.taskName),1),o[3]||(o[3]=a("br",null,null,-1)),a("small",null,"Başlangıç: "+r(c.formatDate(e.start)),1),o[4]||(o[4]=a("br",null,null,-1)),a("small",null,"Bitiş: "+r(c.formatDate(e.end)),1)])))),128))])]))],2)])])])]),a("div",L,[a("div",j,[a("div",R,[a("div",B,[o[6]||(o[6]=a("h5",{class:"mb-0"},"Kapasite Kullanımı",-1)),a("div",E,[a("button",U,r(c.selectedUnit?c.selectedUnit.name:"Tüm Birimler"),1),a("ul",I,[a("li",null,[a("a",{class:"dropdown-item",href:"#",onClick:o[0]||(o[0]=l((e=>c.selectUnit(null)),["prevent"]))}," Tüm Birimler ")]),(p(!0),t(i,null,s(c.productionUnits,(e=>(p(),t("li",{key:e.id},[a("a",{class:"dropdown-item",href:"#",onClick:l((t=>c.selectUnit(e)),["prevent"])},r(e.name),9,_)])))),128))])])]),a("div",M,[a("div",A,[a("canvas",N,null,512)])])])]),a("div",q,[a("div",F,[a("div",G,[o[7]||(o[7]=a("h5",{class:"mb-0"},"Teslimat Tahminleri",-1)),a("div",K,[a("button",$,r(c.timePeriodLabel),1),a("ul",H,[(p(!0),t(i,null,s(c.timePeriods,((e,n)=>(p(),t("li",{key:n},[a("a",{class:"dropdown-item",href:"#",onClick:l((e=>c.selectTimePeriod(n)),["prevent"])},r(e),9,O)])))),128))])])]),a("div",Y,[a("div",z,[a("canvas",Z,null,512)])])])])])])}],["__scopeId","data-v-257e0416"]]);export{W as default};
